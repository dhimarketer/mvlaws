<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Article {{ sections[0].article_number }}</title>
    <style>
        body { font-family: Georgia, serif; margin: 40px; line-height: 1.8; }
        h1 { color: #1c2833; }
        p { margin: 10px 0; text-align: justify; }
        .controls { margin: 20px 0; padding: 15px; background: #f0f8ff; border-radius: 6px; }
        .controls label { font-size: 0.95em; margin-right: 10px; }
        mark {
            background-color: #ffff66;
            padding: 0 2px;
            border-radius: 2px;
            font-weight: bold;
        }
        .nav { margin-top: 20px; }
    </style>
</head>
<body>
    {% if sections %}
        <h1>Article {{ sections[0].article_number }}
           {% if sections[0].article_title %}: {{ sections[0].article_title }}{% endif %}
        </h1>
        
        <!-- Law Source Information -->
        <div style="background: #e8f4fd; border: 1px solid #bee5eb; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #3498db;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 1.2em;">📚</span>
                <div>
                    <strong style="color: #2c3e50; font-size: 1.1em;">Source Law:</strong>
                    {% if sections[0].law_name.startswith('#') %}
                        <span style="color: #e74c3c; font-weight: 600; font-size: 1.1em;">{{ sections[0].law_name[1:] }} (Chapter/Section)</span>
                        <div style="margin-top: 5px; font-size: 0.9em; color: #e67e22;">
                            ⚠️ This appears to be a chapter or section. The full law name may not be properly identified in the database.
                        </div>
                    {% else %}
                        <span style="color: #3498db; font-weight: 600; font-size: 1.1em;">{{ sections[0].law_name }}</span>
                    {% endif %}
                </div>
            </div>
            <div style="margin-top: 8px; color: #7f8c8d; font-size: 0.9em;">
                📍 This article is part of the <strong>{{ sections[0].law_name }}</strong> legislation
                {% if sections[0].law_name.startswith('#') %}
                    <br>
                    <span style="color: #e67e22; font-style: italic;">
                        💡 Based on the content, this appears to be from an anti-terrorism law
                    </span>
                    <br>
                    <span style="color: #e67e22; font-style: italic;">
                        🔍 The "#" prefix suggests this is a chapter or section rather than a complete law
                    </span>
                {% endif %}
                <br>
                <a href="{{ url_for('view_law', law_id=sections[0].law_id) }}" style="color: #3498db; text-decoration: none; font-weight: 500;">
                    🔗 View Full Law
                </a>
            </div>
        </div>
        
        <!-- Breadcrumb Navigation -->
        <div style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px 15px; border-radius: 6px; margin: 15px 0; font-size: 0.9em; color: #6c757d;">
            <span style="color: #6c757d;">📍 Navigation:</span>
            <a href="{{ url_for('index') }}" style="color: #007bff; text-decoration: none; margin: 0 5px;">🏠 Home</a>
            <span style="color: #6c757d;">→</span>
            <a href="{{ url_for('view_law', law_id=sections[0].law_id) }}" style="color: #007bff; text-decoration: none; margin: 0 5px;">
                📘 {% if sections[0].law_name.startswith('#') %}{{ sections[0].law_name[1:] }} (Chapter){% else %}{{ sections[0].law_name }}{% endif %}
            </a>
            <span style="color: #6c757d;">→</span>
            <span style="color: #495057; font-weight: 500;">📄 Article {{ sections[0].article_number }}</span>
        </div>

        {% if query and highlight_flag %}
            <!-- Filtered view -->
            <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <strong>🔍 Filtered Results:</strong> Showing only sub-articles from Article {{ sections[0].article_number }} that match your search terms: <em>"{{ query }}"</em>
                <br><br>
                <a href="{{ url_for('view_article', article_id=request.view_args.article_id) }}" style="color: #856404; text-decoration: underline;">
                    📄 View Complete Article (all sub-articles)
                </a>
            </div>
        {% else %}
            <!-- Full article view -->
            <div style="background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <strong>📄 Complete Article View:</strong> Showing all sub-articles from Article {{ sections[0].article_number }}
                <br><small style="color: #0c5460;">💡 Duplicate sub-articles have been automatically removed for better readability.</small>
                {% if query %}
                    <br><br>
                    <a href="{{ url_for('view_article', article_id=request.view_args.article_id) }}?q={{ query|urlencode }}&highlight=true" style="color: #0c5460; text-decoration: underline;">
                        🔍 View Filtered Results (matching "{{ query }}")
                    </a>
                {% endif %}
            </div>
        {% endif %}

        <!-- Highlight Toggle (only show for filtered view) -->
        {% if query and highlight_flag %}
            <form method="GET" class="controls">
                <input type="hidden" name="q" value="{{ query | e }}">
                <label>
                    <input type="checkbox" name="highlight" value="true" {% if highlight_flag %}checked{% endif %}>
                    Highlight search terms
                </label>
                <button type="submit">Apply</button>
            </form>
        {% endif %}

        {% for sec in sections %}
            <p>
                <strong>Sub-article {{ sec.sub_article_label }}:</strong>
                {{ sec.text_content | safe }}
            </p>
        {% endfor %}
    {% else %}
        <p>No article found.</p>
    {% endif %}

    <div class="nav">
        <div style="margin-bottom: 15px;">
            <a href="{{ url_for('index') }}">← Back to Search</a>
            {% if query %}
                | <a href="{{ url_for('index') }}?query={{ query|urlencode }}">← Back to Search Results</a>
            {% endif %}
        </div>
    </div>
</body>
</html>
